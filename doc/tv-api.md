# TradingView Data API

| URL                                                         | Method           |  Function       |
| -------------                                               | -------------    |-------------    |  
| /tv/ticker/{symbol}/{interval}?begin={begin}&end={end}      | GET              | getTicker       |    
| /tv/track/{symbol}/{interval}                               | POST/GET         | 收集数据到数据库中 |    


## 说明

- 本服务运行在 `httt://us2.altx.top:30080` 上，以下简称 `us2`
- 第一个 API 是从 `us2` 本地数据库中读取的，如果没有数据，则说明还没有抓取过给定 `symbol/interval` 的数据，可以执行第二条 API 进行抓取
- 第二个 API 是以 `symbol/interval` 为参数从 `TradingView` 请求数据，提取后保存至 `us2` 的数据库中
  > **第二个 API 会在 `10s` 内返回，但抓取工作可能要持续数分钟（数据库插入比较慢），昨天在我本地测试的情况是大约 `2min` 内完成**

## 操作示例

- 获取 Ticker

    | 参数          |  值               | 说明                                      | 
    | ------------- | ---              | -------------                             |
    | symbol        | BITFINEX:BTCUSD  |                                           |    
    | interval      | 120              | 分钟为基数，如 `5` 为 5 分钟, `120` 为 2 小时 |    
    | begin         | 1483279200       | 2017-01-01 22:00:00 秒为基数，UNIX时间戳    |    
    | end           | 1483286400       | 2017-01-02 00:00:00                       |    

  > 构造请求：  
    ```
    http://us2.altx.top:30080/tv/ticker/BITFINEX:BTCUSD/120?begin=1483279200&end=1483286400
    ```

  > 响应：
    ```json5
    [
        {
            "mark": 1483279200,
            "d1": 976.58,
            "d2": 982,
            "d3": 976,
            "d4": 981.96,
            "d5": 552.93295849
        },
        {
            "mark": 1483286400,
            "d1": 981.97,
            "d2": 999,
            "d3": 976.24,
            "d4": 994.31,
            "d5": 5156.8511124
        }
    ]
    ```
    


- 数据抓取

    | 参数          |  值               | 说明                                      | 
    | ------------- | ---              | -------------                             |
    | symbol        | BITFINEX:BTCUSD  |                                           |    
    | interval      | 15              | 分钟为基数，如 `1` 为 1 分钟, `15` 为 15 分钟 |    

  > 构造请求：  
    ```
    http://us2.altx.top:30080/tv/track/BITFINEX:BTCUSD/15
    ```

  > 响应：
    ```json5
    0
    ```
    

## 获取 Ticker 辅助参数

- 输入友好模式

    | 参数           |  值              | 说明                                       | 
    | ------------- | ---              | -------------                             |
    | humanIn       | true             | begin/end 时间类型开关                      |    
    | begin         | 201701012200     | 2017-01-01 22:00 输入友好模式，只精确到分钟   |    
    | end           | 201701020000     | 2017-01-02 00:00 输入友好模式，只精确到分钟   |    
  
  > 构造请求：  
    ```
    http://us2.altx.top:30080/tv/ticker/BITFINEX:BTCUSD/120?begin=201701012200&end=201701020000&humanIn=true
    ```

- 输出友好模式

    | 参数           |  值               | 说明                                      | 
    | ------------- | ---               | -------------                             |
    | humanOut       | true             | 结果集中 `mark` 改为人可读模式开关           | 
  
  > 构造请求：  
    ```
    http://us2.altx.top:30080/tv/ticker/BITFINEX:BTCUSD/120?begin=1483279200&end=1483286400&humanOut=true
    ```    
  
  > 响应：
  ```json5
  [
      {
          "mark": 201701012200,
          "d1": 976.58,
          "d2": 982,
          "d3": 976,
          "d4": 981.96,
          "d5": 552.93295849
      },
      {
          "mark": 201701020000,
          "d1": 981.97,
          "d2": 999,
          "d3": 976.24,
          "d4": 994.31,
          "d5": 5156.8511124
      }
  ]
  ```